This tree contains a couple of new aggregation stages, $socketBSON and $httpGET

$httpGET takes a URI (optionally with paramters in the "query" field) and expects a single JSON document back.

$socketBSON creates a bidirectional stream of BSON documents on a 1-1 basis. For each document in, you should get one document back.
If you don't specify a "localField", it currently expects a unidirectional input stream of BSON. Will add other options later.
$socketBSON only supports IPv4 - fix it if you care ;-)

Some of the tests use a sample mysql database found here: 
https://dev.mysql.com/doc/world-setup/en/world-setup-installation.html

Example xinetd conf files are in xinetd/ - put them in /etc/xinetd.d and do "service xinetd restart"
There's some sample test data in test/
Some python scripts of example connectors in the connectors/ directory

The trickiest thing with $socketBSON is unwanted IO buffering. Using "python -u" helps.

---------------------------------------------------------------------------

$httpGET examples:

db.test.aggregate({'$httpGET':'https://www.quandl.com/api/v3/datasets/FRED/NGDPPOT.json'})

db.test.aggregate([{'$httpGET':{'uri':'http://api.nytimes.com/svc/search/v2/articlesearch.json','query':{'q':'obama','api-key':'c2fede7bd9aea57c898f538e5ec0a1ee:6:68700045'}}}), {$unwind: {path:"$response.docs"}}, {$limit:1}])

---------------------------------------------------------------------------

$socketBSON examples:

First, let's look at the data that get written to the pipe by mongod
$ cat ~/test/mysql_execute.json
{"host":"localhost", "user":"mbligh", "passwd":"", "db":"world", "sql":"SELECT CountryCode,Name,Population FROM City WHERE District=%s", "wherekeys":["district"]}
{"district":"Iowa"}
{"district":"Virginia"}

Now the data that will be in the reply.
$ json2bson < ~/test/mysql_execute.json | mysql_execute | bson2json
{"": [{"Name": "Des Moines", "CountryCode": "USA", "Population": 198682}, {"Name": "Cedar Rapids", "CountryCode": "USA", "Population": 120758}, {"Name": "Davenport", "CountryCode": "USA", "Population": 98256}]}
{"": [{"Name": "Virginia Beach", "CountryCode": "USA", "Population": 425257}, {"Name": "Norfolk", "CountryCode": "USA", "Population": 234403}, {"Name": "Chesapeake", "CountryCode": "USA", "Population": 199184}, {"Name": "Richmond", "CountryCode": "USA", "Population": 197790}, {"Name": "Newport News", "CountryCode": "USA", "Population": 180150}, {"Name": "Arlington", "CountryCode": "USA", "Population": 174838}, {"Name": "Hampton", "CountryCode": "USA", "Population": 146437}, {"Name": "Alexandria", "CountryCode": "USA", "Population": 128283}, {"Name": "Portsmouth", "CountryCode": "USA", "Population": 100565}, {"Name": "Roanoke", "CountryCode": "USA", "Population": 93357}]}


Now let's make that happen with aggregate:
> db.test.aggregate({'$socketBSON':{host:'localhost',port:668, localField:'', as:'cities', initial:{"host":"localhost", "user":"mbligh", "passwd":"", "db":"world", "sql":"SELECT CountryCode,Name,Population FROM City WHERE District=%s", "wherekeys":["district"]}}}).pretty()
{
        "_id" : ObjectId("5723cbb9f08e20a32022a52f"),
        "district" : "Iowa",
        "cities" : {
                "" : [
                        { "Name" : "Des Moines", "CountryCode" : "USA", "Population" : NumberLong(198682) },
                        { "Name" : "Cedar Rapids", "CountryCode" : "USA", "Population" : NumberLong(120758) },
                        { "Name" : "Davenport","CountryCode" : "USA", "Population" : NumberLong(98256) }
                ]
        }
}
{
        "_id" : ObjectId("5723cbb9f08e20a32022a530"),
        "district" : "Virginia",
        "cities" : {
                "" : [
                        { "Name" : "Virginia Beach",  "CountryCode" : "USA","Population" : NumberLong(425257) },
                        { "Name" : "Norfolk", "CountryCode" : "USA",  "Population" : NumberLong(234403) },
                        { "Name" : "Chesapeake", "CountryCode" : "USA", "Population" : NumberLong(199184) },
          ....
                ]
}
